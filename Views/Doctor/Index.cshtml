@model Final_project.Models.Doctor
@using System.Linq;

@{
    ViewData["Title"] = "Doctor Profile";

    // Defining the main brand color for consistent styling
    var brandPrimary = "#003366";

    // 1. Filtering and ordering appointments for the current day
    var todayAppointments = Model.Appointments
        .Where(a => a.AppointmentDate.Date == DateTime.Today.Date)
        .OrderBy(a => a.AppointmentDate);
}

@if (TempData["ValidationErrors"] != null)
{
    <div class="alert alert-danger" role="alert">
        <h4 class="alert-heading">🚫 Save Failed! Technical Reason:</h4>
        <p>@TempData["ValidationErrors"]</p>
        <hr>
        <p class="mb-0">Please correct this error in the code or database.</p>
    </div>
}
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="container mt-5">
    <div class="row g-4 d-flex align-items-stretch">

        <div class="col-md-4">
            <div class="card p-3 shadow-lg h-100 border-0" style="border-radius: 12px;">
                <div class="text-center">
                    <img src="~/images/doctor_profile.jpg" alt="@Model.Name"
                         class="img-fluid rounded-circle mb-3"
                         style="width: 130px; height: 130px; object-fit: cover; border: 4px solid @brandPrimary;">

                    <h4 class="fw-bolder mb-0" style="color: #343a40;">@Model.Name</h4>
                    <p class="text-muted mb-3">@Model.Specialty</p>
                </div>

                <hr class="my-3">

                <div class="row text-center mb-3">
                    <div class="col-12 text-start px-4">
                        <p class="mb-2 text-muted fw-light"><i class="bi bi-calendar3 me-2" style="color: @brandPrimary;"></i> Age: <span class="float-end fw-bold" style="color: #343a40;">35 Years</span></p>
                        <p class="mb-2 text-muted fw-light"><i class="bi bi-clock me-2" style="color: @brandPrimary;"></i> Experience: <span class="float-end fw-bold text-success">10+ Years</span></p>
                    </div>
                </div>

                <div class="mt-4 border-top pt-3">
                    <h6 class="fw-bold" style="color: @brandPrimary;"><i class="bi bi-info-circle me-1"></i> Contact Information</h6>
                    <p class="mb-1 fw-light"><i class="bi bi-telephone-fill me-2 text-secondary"></i> **Phone:** <span class="float-end">@Model.Phone</span></p>
                    <p class="mb-1 fw-light"><i class="bi bi-house-door-fill me-2 text-secondary"></i> **Address:** <span class="float-end text-break">@Model.Address</span></p>
                </div>

            </div>
        </div>

        <div class="col-md-8">
            <div class="card p-4 shadow-lg h-100 border-0" ">

                <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="account-tab" data-bs-toggle="tab" data-bs-target="#account" type="button" role="tab" style="color: @brandPrimary; border-bottom: 3px solid @brandPrimary;">Account Settings</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="company-tab" data-bs-toggle="tab" data-bs-target="#company" type="button" role="tab">Clinic Settings</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="billing-tab" data-bs-toggle="tab" data-bs-target="#billing" type="button" role="tab">Billing</button>
                    </li>
                </ul>

                <div class="tab-content" id="profileTabsContent">

                    <div class="tab-pane fade show active" id="account" role="tabpanel" aria-labelledby="account-tab">
                        <form>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="fullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="fullName" value="@Model.Name" disabled>
                                </div>
             
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="phoneNumber" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phoneNumber" value="@Model.Phone">
                                </div>
                                <div class="col-md-6">
                                    <label for="specialty" class="form-label">Specialty</label>
                                    <input type="text" class="form-control" id="specialty" value="@Model.Specialty">
                                </div>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label for="address" class="form-label">Full Address</label>
                                    <input type="text" class="form-control" id="address" value="@Model.Address">
                                </div>
                                <div class="col-md-6">
                                    <label for="country" class="form-label">Country (Simulated)</label>
                                    <select class="form-select" id="country">
                                        <option value="Egypt" selected>Arab Republic of Egypt</option>
                                    </select>
                                </div>
                            </div>

                            <a asp-action="Edit"
                               asp-route-id="@Model.Doctor_ID"
                               class="btn fw-bold text-white shadow-sm"
                               style="background-color: @brandPrimary; border-color: @brandPrimary; transition: background-color 0.3s ease; min-width: 150px;">
                                <i class="bi bi-pencil-square me-2"></i> Edit Data
                            </a>
                        </form>
                    </div>

                    <div class="tab-pane fade" id="company" role="tabpanel" aria-labelledby="company-tab">
                        <div class="alert alert-light text-center" role="alert">
                            <i class="bi bi-hospital fs-4 me-2"></i> Clinic settings options will be available here soon.
                        </div>
                    </div>

                    <div class="tab-pane fade" id="billing" role="tabpanel" aria-labelledby="billing-tab">
                        <div class="alert alert-light text-center" role="alert">
                            <i class="bi bi-credit-card fs-4 me-2"></i> Billing and Invoice history under development.
                        </div>
                    </div>


                </div>

            </div>
        </div>
    </div>

    <hr class="my-5" style="border-top: 2px solid #ddd;">

    <div class="row">
        <div class="col-12">
            <div class="card p-4 shadow-lg border-2" style="border-radius: 12px;margin-top:-40px; border-color: @brandPrimary !important;">
                <h4 class="card-title fw-bolder" style="color: @brandPrimary; margin-bottom: 1.5rem;"><i class="bi bi-calendar-check me-2"></i> Today's Appointments (@DateTime.Today.ToString("yyyy/MM/dd"))</h4>

                @if (todayAppointments.Any())
                {
                    <div class="table-responsive">
                        @* لجعل الجدول متجاوباً على الجوال *@
                        <table class="table table-striped table-hover align-middle">
                            <thead class="table-dark" style="background-color: @brandPrimary !important;">
                                <tr>
                                    <th>#</th>
                                    <th>Time</th>
                                    <th>Patient Name</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var count = 1;
                                }
                                @foreach (var appointment in todayAppointments)
                                {
                                    <tr>
                                        <td>@(count++)</td>
                                        <td><span class="fw-bold">@appointment.AppointmentDate.ToString("hh:mm tt")</span></td>
                                        <td>@appointment.Patient?.fullName</td>
                                        <td><span class="badge bg-success">Confirmed</span></td>
                                        <td>
                                            <a href="#" class="btn btn-sm btn-outline-info me-2"><i class="bi bi-eye"></i> View</a>
                                            <a href="#" class="btn btn-sm btn-outline-danger"><i class="bi bi-x-circle"></i> Cancel</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-light text-center py-4" role="alert">
                        <i class="bi bi-emoji-smile fs-3 mb-2 d-block"></i>
                        No appointments scheduled for today.
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Bootstrap Tab initialization logic
        document.addEventListener('DOMContentLoaded', function () {
            var triggerTabList = [].slice.call(document.querySelectorAll('#profileTabs button'));
            triggerTabList.forEach(function (triggerEl) {
                var tabTrigger = new bootstrap.Tab(triggerEl);

                triggerEl.addEventListener('click', function (event) {
                    event.preventDefault();
                    tabTrigger.show();
                });
            });
        });
    </script>
}